<template>
  <v-card flat width="100%">
    <v-card-title>
      <h1 class="text-center">TERMO DE USO DA PLATAFORMA JUSPERÍCIA</h1>
    </v-card-title>
    <v-card-text class="px-12">
      <p class="text-justify mb-4">
        <logo height="50" />
      </p>
      <section>
        <p><strong class="mr-2">Atualizado em:</strong>28/05/2025</p>
        <p>
          Este Termo de Uso disciplina as condições de acesso e uso da
          plataforma digital JUSPERÍCIA, desenvolvida e administrada por
          <strong>JUSPERÍCIA TECNOLOGIA EM SOLUÇÕES PERICIAIS LTDA</strong>,
          inscrita no CNPJ sob o nº 59.617.259/0001-29, com sede na Rua Deputado
          Aral Moreira, s/n, Centro, Ponta Porã/MS, doravante denominada
          simplesmente "JUSPERÍCIA". Ao acessar ou utilizar qualquer
          funcionalidade da Plataforma, o usuário declara que leu, compreendeu e
          concorda integralmente com as disposições abaixo.
        </p>

        <h2>1. OBJETIVO DA PLATAFORMA</h2>
        <p>
          A Plataforma JUSPERÍCIA tem como finalidade exclusiva viabilizar a
          intermediação de serviços médicos periciais destinados à elaboração de
          laudos técnicos para fins judiciais, administrativos ou processuais,
          mediante solicitação de advogados, clínicas jurídicas e terceiros
          autorizados, devidamente cadastrados.
        </p>

        <h2>2. CADASTRO E RESPONSABILIDADE DOS USUÁRIOS</h2>
        <p>
          <strong>2.1.</strong> O acesso às funcionalidades da JUSPERÍCIA é
          condicionado ao cadastro prévio do usuário, com inserção de dados
          completos, atualizados e verídicos, cuja veracidade é presumida até
          prova em contrário.
        </p>

        <p>
          <strong>2.2.</strong> O usuário é integral e exclusivamente
          responsável por:
        </p>
        <ul>
          <li>Todas as informações fornecidas;</li>
          <li>Documentos médicos anexados para análise;</li>
          <li>
            Obtenção do consentimento livre e informado do paciente, conforme
            Lei 13.709/2018 (LGPD);
          </li>
          <li>Uso adequado dos laudos emitidos.</li>
        </ul>

        <p>
          <strong>2.3.</strong> A JUSPERÍCIA não se responsabiliza por dados,
          documentos ou registros fornecidos de forma fraudulenta ou errônea.
        </p>

        <h2>3. LIMITAÇÃO DE RESPONSABILIDADE DA JUSPERÍCIA</h2>
        <p>
          <strong>3.1.</strong> A JUSPERÍCIA atua exclusivamente como ferramenta
          intermediadora e plataforma digital, não sendo responsável por:
        </p>
        <ul>
          <li>Falhas, omissões ou fraudes nos dados inseridos;</li>
          <li>
            Conteúdo, opinião técnica ou conclusão dos laudos emitidos por
            médicos;
          </li>
          <li>
            Consequências judiciais ou administrativas derivadas da utilização
            dos laudos.
          </li>
        </ul>

        <p>
          <strong>3.2.</strong> Os profissionais médicos são autônomos e
          independentes, respondendo tecnicamente pelos documentos que emitirem,
          nos termos dos seus respectivos órgãos de classe.
        </p>
        <p>
          <strong>3.3.</strong> A Plataforma não realiza atendimento clínico,
          ambulatorial, hospitalar ou emergencial. Tampouco presta serviços
          voltados à medicina preventiva, assistencial, previdenciária ou para
          planos de saúde.
        </p>

        <h2>4. USO ADEQUADO DA PLATAFORMA</h2>
        <p><strong>4.1.</strong> O usuário compromete-se a:</p>
        <ul>
          <li>
            Utilizar a Plataforma exclusivamente para fins lícitos e compatíveis
            com a finalidade pericial/jurídica;
          </li>
          <li>
            Não promover o uso indevido, como falsificação de documentos ou
            indução ao erro judicial;
          </li>
          <li>Não compartilhar credenciais de acesso com terceiros.</li>
        </ul>

        <p>
          <strong>4.2.</strong> A utilização da plataforma com dolo, fraude ou
          simulação de relação jurídica ensejará:
        </p>
        <ul>
          <li>Suspensão ou exclusão imediata da conta;</li>
          <li>
            Comunicação a órgãos de controle, conselhos de classe e autoridades;
          </li>
          <li>Responsabilização cível e criminal.</li>
        </ul>

        <p>
          <strong>4.3.</strong> Os laudos emitidos não podem ser alterados,
          replicados ou reutilizados para fins não autorizados, sob pena de
          infração ética e legal.
        </p>

        <h2>5. PROTEÇÃO DE DADOS PESSOAIS</h2>
        <p>
          <strong>5.1.</strong> A JUSPERÍCIA realiza o tratamento de dados
          pessoais em conformidade com a Lei Geral de Proteção de Dados (LGPD –
          Lei 13.709/2018), mantendo um ambiente seguro, criptografado e
          controlado.
        </p>
        <p>
          <strong>5.2.</strong> O usuário é co-responsável pela legalidade da
          coleta de dados do paciente, assumindo responsabilidade por eventuais
          danos decorrentes de uso não autorizado.
        </p>
        <p><strong>5.3.</strong> Os dados poderão ser compartilhados apenas:</p>
        <ul>
          <li>Com os médicos vinculados à elaboração dos laudos;</li>
          <li>Para cumprimento de obrigações legais e ordens judiciais;</li>
          <li>
            Com parceiros técnicos vinculados à operacionalização da Plataforma,
            sob sigilo contratual.
          </li>
        </ul>

        <h2>6. PAGAMENTOS E CONDIÇÕES COMERCIAIS</h2>
        <p>
          <strong>6.1.</strong> Os serviços estão condicionados ao pagamento
          prévio, conforme valores praticados e aceitos no momento da
          contratação.
        </p>
        <p>
          <strong>6.2.</strong> A JUSPERÍCIA poderá modificar preços, planos ou
          condições mediante aviso prévio.
        </p>
        <p>
          <strong>6.3.</strong> O não pagamento resultará no cancelamento
          automático da solicitação, sem qualquer obrigatoriedade de reembolso.
        </p>

        <h2>7. PROPRIEDADE INTELECTUAL</h2>
        <p>
          <strong>7.1.</strong> Todo o conteúdo da Plataforma é protegido por
          direitos autorais, sendo vedada sua utilização, cópia ou distribuição
          sem autorização escrita da JUSPERÍCIA.
        </p>

        <h2>8. PENALIDADES E ENCERRAMENTO DE ACESSO</h2>
        <p><strong>8.1.</strong> A violação deste Termo implicará:</p>
        <ul>
          <li>Suspensão temporária ou definitiva do acesso;</li>
          <li>Perda de acesso a dados e histórico de solicitações;</li>
          <li>Medidas legais cabíveis.</li>
        </ul>

        <h2>9. ALTERAÇÕES DO TERMO DE USO</h2>
        <p>
          <strong>9.1.</strong> A JUSPERÍCIA poderá modificar este Termo a
          qualquer tempo. O uso da Plataforma após as alterações constitui
          aceitação plena e irretratável.
        </p>

        <h2>10. LEGISLAÇÃO APLICÁVEL E FORO</h2>
        <p>
          <strong>10.1.</strong> Este Termo será regido pelas normas do Código
          Civil, LGPD, Marco Civil da Internet, Código de Defesa do Consumidor e
          demais normas brasileiras.
        </p>
        <p>
          <strong>10.2.</strong> Fica eleito o foro da comarca de Ponta Porã/MS,
          com renúncia a qualquer outro, por mais privilegiado que seja.
        </p>
      </section>
    </v-card-text>
    <v-card-text>
      <NuxtTurnstile ref="turnstile" v-model="cloudFlareToken" />
    </v-card-text>
    <v-card-actions class="d-flex px-4">
      <Button
        @click="handleAccpetTerms"
        variant="outlined"
        color="grey"
        size="small"
        :loading="loading"
        :disabled="disabledButtons"
      >
        <v-icon icon="mdi-close" color="colorIcon" start />
        <span class="text-primary text-caption">
          Li e concordo com os termos
        </span>
      </Button>
      <Button
        @click="handleRejectTerms"
        variant="outlined"
        color="red"
        size="small"
        :loading="loading"
        :disabled="disabledButtons"
      >
        <v-icon icon="mdi-close" color="red" start />
        <span class="text-primary text-caption"> Não concordo </span>
      </Button>
    </v-card-actions>
    <v-overlay :model-value="loading" class="align-center justify-center">
      <v-progress-circular color="primary" size="64" indeterminate />
    </v-overlay>
  </v-card>
</template>

<script setup lang="ts">
//import type { IpInfo } from "~/composables/useIpInfo";

definePageMeta({
  title: "Termos de Serviço",
  description: "Termos de Serviço",
  middleware: undefined,
  layout: "empty",
});

const cloudFlareToken = ref("");
const auth = useAuthStore();
const router = useRouter();
const loading = ref(false);
const disabledButtons = ref(true); // Inicialmente desabilitado até o Turnstile carregar
const $currentUser = computed(() => auth.$currentUser);
const { getIpInfo } = useIpInfo();

// Watch para monitorar o token do Turnstile
watch(
  cloudFlareToken,
  (newToken) => {
    // Se o token estiver vazio, desabilita os botões
    // Se o token tiver valor, habilita os botões
    disabledButtons.value = !newToken || newToken.trim() === "";
  },
  {
    immediate: true,
  }
);

const handleAccpetTerms = async () => {
  if (!$currentUser.value) return;

  loading.value = true;
  disabledButtons.value = true;
  try {
    // Captura informações de IP
    const ipInfo: IpInfo = await getIpInfo();

    console.log("Informações de IP capturadas:", ipInfo);

    // Envia os dados para o back-end incluindo as informações de IP
    await auth.consentTerms(cloudFlareToken.value, ipInfo);
    await auth.verifyUser($currentUser.value.publicId!);

    // Aguarda a próxima atualização do DOM para garantir que o estado foi atualizado
    await nextTick();

    router.push("/");
  } catch (error) {
    console.log(error);
  } finally {
    loading.value = false;
    disabledButtons.value = false;
  }
};

const handleRejectTerms = () => {
  auth.logout();
  router.push("/");
};
</script>

<style scoped></style>
